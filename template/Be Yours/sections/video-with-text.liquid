{% schema %}
{
  "name": "Advanced Video with Text",
  "settings": [
    {
      "type": "video",
      "id": "video",
      "label": "Upload video"
    },

    {
      "type": "select",
      "id": "layout",
      "label": "Video position",
      "default": "left",
      "options": [
        { "value": "left", "label": "Video Left" },
        { "value": "right", "label": "Video Right" }
      ]
    },

    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "Autoplay Video",
      "default": true
    },

    {
      "type": "checkbox",
      "id": "loop",
      "label": "Loop Video",
      "default": true
    },

    {
      "type": "checkbox",
      "id": "controls",
      "label": "Show Video Controls",
      "default": false
    },

    {
      "type": "range",
      "id": "video_width",
      "label": "Video width (%)",
      "min": 20,
      "max": 80,
      "step": 5,
      "default": 50
    },

    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Your Heading Here"
    },

    {
        "type": "richtext",
        "id": "description",
        "label": "Description",
        "default": "<p>Your description text goes here.</p>"
    },

    {
      "type": "header",
      "content": "Video Padding"
    },
    {
      "type": "range",
      "id": "video_padding_vertical",
      "label": "Vertical padding (top & bottom)",
      "min": 0,
      "max": 120,
      "step": 5,
      "default": 0
    },
    {
      "type": "range",
      "id": "video_padding_horizontal",
      "label": "Horizontal padding (left & right)",
      "min": 0,
      "max": 120,
      "step": 5,
      "default": 0
    },

    {
      "type": "header",
      "content": "Text Padding"
    },
    {
      "type": "range",
      "id": "text_padding_vertical",
      "label": "Vertical padding (top & bottom)",
      "min": 0,
      "max": 120,
      "step": 5,
      "default": 0
    },
    {
      "type": "range",
      "id": "text_padding_horizontal",
      "label": "Horizontal padding (left & right)",
      "min": 0,
      "max": 120,
      "step": 5,
      "default": 0
    },

    {
      "type": "range",
      "id": "max_height",
      "label": "Max section height (px)",
      "min": 300,
      "max": 1000,
      "step": 50,
      "default": 600
    }
  ],
  "presets": [
    {
      "name": "Advanced Video with Text"
    }
  ]
}
{% endschema %}

{% assign text_width = 100 | minus: section.settings.video_width %}

<section class="advanced-video-text layout-{{ section.settings.layout }}">

  <div
    class="video-wrapper"
    style="
      width: {{ section.settings.video_width }}%;
      padding: {{ section.settings.video_padding_vertical }}px {{ section.settings.video_padding_horizontal }}px;
    "
  >
    {% if section.settings.video %}
      <div class="video-inner">
        {{ section.settings.video | video_tag:
            controls: section.settings.controls,
            loop: section.settings.loop,
            autoplay: section.settings.autoplay,
            muted: section.settings.autoplay,
            playsinline: true
        }}
      </div>
    {% endif %}
  </div>

  <div
    class="text-wrapper"
    style="
      width: {{ text_width }}%;
      padding: {{ section.settings.text_padding_vertical }}px {{ section.settings.text_padding_horizontal }}px;
    "
  >
    <h2>{{ section.settings.heading }}</h2>
    <div class="rte">
      {{ section.settings.description }}
    </div>
  </div>

</section>

<style>
.advanced-video-text {
  display: flex;
  width: 100%;
  align-items: stretch;
}

/* Reverse layout */
.advanced-video-text.layout-right {
  flex-direction: row-reverse;
}

/* Important fix for padding resizing */
.video-wrapper,
.text-wrapper {
  box-sizing: border-box;
  display: flex;
  align-items: center;
}

.video-inner {
  width: 100%;
  aspect-ratio: 4 / 5;
  max-height: {{ section.settings.max_height }}px;
  overflow: hidden;
}

.video-inner video {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* Mobile */
@media(max-width: 768px) {
  .advanced-video-text {
    flex-direction: column !important;
  }

  .video-wrapper,
  .text-wrapper {
    width: 100% !important;
  }

  .video-inner,
  .video-inner video {
    max-height: none !important;
  }
}
</style>
